<!-- Loading -->
<div *ngIf="loading" class="flex items-center justify-center p-8">
    <mat-spinner diameter="40"></mat-spinner>
</div>

<!-- Form -->
<div *ngIf="!loading" class="flex flex-col flex-auto p-6 sm:p-8">
    
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between pb-8">
        <div class="text-3xl font-extrabold tracking-tight leading-none">
            {{isEditMode ? 'Editar Prompt' : 'Crear Prompt'}}
        </div>
    </div>

    <!-- Form -->
    <form [formGroup]="promptForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-6">
        
        <!-- Basic Information -->
        <mat-card class="p-6">
            <mat-card-header>
                <mat-card-title>Información Básica</mat-card-title>
            </mat-card-header>
            <mat-card-content class="pt-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Title -->
                    <mat-form-field class="md:col-span-2">
                        <mat-label>Título *</mat-label>
                        <input matInput formControlName="title" placeholder="Nombre del prompt">
                        <mat-error *ngIf="promptForm.get('title')?.hasError('required')">
                            El título es requerido
                        </mat-error>
                        <mat-error *ngIf="promptForm.get('title')?.hasError('maxlength')">
                            Máximo 100 caracteres
                        </mat-error>
                    </mat-form-field>

                    <!-- Description -->
                    <mat-form-field class="md:col-span-2">
                        <mat-label>Descripción</mat-label>
                        <textarea matInput formControlName="description" rows="3" 
                                  placeholder="Descripción del prompt"></textarea>
                        <mat-error *ngIf="promptForm.get('description')?.hasError('maxlength')">
                            Máximo 500 caracteres
                        </mat-error>
                    </mat-form-field>

                    <!-- Category -->
                    <mat-form-field>
                        <mat-label>Categoría *</mat-label>
                        <mat-select formControlName="category">
                            <mat-option *ngFor="let category of categories" [value]="category.id">
                                {{category.name}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="promptForm.get('category')?.hasError('required')">
                            Selecciona una categoría
                        </mat-error>
                    </mat-form-field>

                    <!-- Language -->
                    <mat-form-field>
                        <mat-label>Idioma *</mat-label>
                        <mat-select formControlName="language">
                            <mat-option *ngFor="let language of languages" [value]="language">
                                {{language}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <!-- Tags -->
                    <mat-form-field class="md:col-span-2">
                        <mat-label>Tags</mat-label>
                        <mat-chip-list #chipList aria-label="Tags">
                            <mat-chip 
                                *ngFor="let tag of promptForm.get('tags')?.value; let i = index"
                                [selectable]="false"
                                [removable]="true"
                                (removed)="removeTag(i)">
                                {{tag}}
                                <mat-icon matChipRemove>cancel</mat-icon>
                            </mat-chip>
                            <input 
                                placeholder="Agregar tag..."
                                #tagInput
                                [matChipInputFor]="chipList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                (matChipInputTokenEnd)="addTag($event)">
                        </mat-chip-list>
                    </mat-form-field>

                    <!-- Switches -->
                    <div class="flex flex-col gap-4">
                        <mat-slide-toggle formControlName="isPublic">
                            Público
                        </mat-slide-toggle>
                        <mat-slide-toggle formControlName="isActive">
                            Activo
                        </mat-slide-toggle>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Content -->
        <mat-card class="p-6">
            <mat-card-header>
                <mat-card-title>Contenido del Prompt</mat-card-title>
            </mat-card-header>
            <mat-card-content class="pt-4">
                <mat-form-field class="w-full">
                    <mat-label>Contenido *</mat-label>
                    <textarea 
                        matInput 
                        formControlName="content" 
                        rows="10"
                        placeholder="Escribe aquí el contenido del prompt..."></textarea>
                    <mat-error *ngIf="promptForm.get('content')?.hasError('required')">
                        El contenido es requerido
                    </mat-error>
                    <mat-error *ngIf="promptForm.get('content')?.hasError('maxlength')">
                        Máximo 5000 caracteres
                    </mat-error>
                </mat-form-field>
            </mat-card-content>
        </mat-card>

        <!-- Actions -->
        <div class="flex items-center justify-between">
            <button mat-button type="button" (click)="cancel()">
                Cancelar
            </button>
            
            <button 
                mat-flat-button 
                [color]="'primary'" 
                type="submit"
                [disabled]="saving">
                <mat-spinner diameter="20" *ngIf="saving"></mat-spinner>
                <span *ngIf="!saving">{{isEditMode ? 'Actualizar' : 'Crear'}} Prompt</span>
            </button>
        </div>
    </form>
</div>